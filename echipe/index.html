// Înlocuiește funcția adminStartSezon și adaugă generaFazaUrmatoare în script-ul tău

window.adminStartSezon = async (tip) => {
    const ed = globalData.ed_JOKER;
    const inscrisi = globalData.inscrisi_JOKER;
    let f1 = {};
    const gList = ['1','2','3','4'];
    
    gList.forEach((gk) => {
        const p = inscrisi.filter(n => state.manualGrupe[n] === gk);
        if(p.length > 0) {
            f1[gk] = { participanti: p, meciuri: [] };
            for(let i=0; i<p.length; i++) {
                for(let j=i+1; j<p.length; j++) {
                    f1[gk].meciuri.push({ id: "MT-"+Math.random().toString(36).substr(2,9), p1: p[i], p2: p[j], s1t:0, s2t:0, s1r:0, s2r:0, gata: false });
                }
            }
        }
    });
    await setDoc(doc(db, "sezoane", `JOKER_TEAM_${ed}`), { f1, status: 'activ', fazaCurenta: 'f1' });
};

window.generaFazaUrmatoare = async () => {
    const data = {...currentSezonData};
    const deasupra = (gn) => calculeazaClasament(data.f1[gn]);
    
    // Extragere clasamente
    const c1 = deasupra('1'), c2 = deasupra('2'), c3 = deasupra('3'), c4 = deasupra('4');

    const creeazaMeciSF = (p1, p2) => ({
        id: "MSF-"+Math.random().toString(36).substr(2,9),
        p1: p1.nume, p2: p2.nume, s1t:0, s2t:0, s1r:0, s2r:0, gata: false
    });

    data.semi = {
        "SF 1": { 
            participanti: [c1[0].nume, c2[1].nume, c3[0].nume, c4[1].nume],
            meciuri: [creeazaMeciSF(c1[0], c2[1]), creeazaMeciSF(c3[0], c4[1])]
        },
        "SF 2": { 
            participanti: [c2[0].nume, c1[1].nume, c4[0].nume, c3[1].nume],
            meciuri: [creeazaMeciSF(c2[0], c1[1]), creeazaMeciSF(c4[0], c3[1])]
        }
    };
    
    data.fazaCurenta = 'semi';
    await updateDoc(doc(db, "sezoane", `JOKER_TEAM_${globalData.ed_JOKER}`), data);
};

// Modifică în render() secțiunea de buton:
// Verificăm dacă toate meciurile din toate grupele f1 sunt 'gata'
const toateGata = curSezon.f1 && Object.values(curSezon.f1).every(g => g.meciuri.every(m => m.gata));

if(isAdmin() && toateGata && !curSezon.semi) {
    html += `<button onclick="generaFazaUrmatoare()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-black uppercase text-sm mb-10 shadow-xl border-b-4 border-green-800 active:border-0">Generează Semifinale (Sistem X)</button>`;
}
