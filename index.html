<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turneu Joker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBG5193qgq-dNX41yhCgXrl9WFNLhUiNnU",
            authDomain: "turneu-cruce.firebaseapp.com",
            projectId: "turneu-cruce",
            storageBucket: "turneu-cruce.firebasestorage.app",
            messagingSenderId: "169022341825",
            appId: "1:169022341825:web:53678e9ce275654bfe4a40"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const ADMINS = ["isshmen@gmail.com", "admin@admin.ro"];
        let userLogat = null;
        let currentSezonData = null;
        let state = { pagina: "home", idGrupa: null, search: "" };

        const isAdmin = () => userLogat && ADMINS.includes(userLogat.email);

        window.loginGoogle = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth);
        window.nav = (p, g=null) => { state = { ...state, pagina:p, idGrupa:g }; render(); };
        window.handleSearch = (val) => { state.search = val.toLowerCase(); render(); };

        window.adminModificaNume = async () => {
            if(!isAdmin()) return;
            const vechi = prompt("Numele de modificat:");
            const nou = prompt("Numele nou:");
            if(!vechi || !nou) return;
            let dataStr = JSON.stringify(currentSezonData);
            if(!dataStr.includes(vechi)) return alert("Numele nu a fost gƒÉsit!");
            dataStr = dataStr.split(vechi).join(nou);
            await setDoc(doc(db, "sezoane", "JOKER_2"), JSON.parse(dataStr));
            alert("Nume actualizat!");
        };

        window.updateScorMeci = async (mId, set, p1, p2, titular) => {
            if(!isAdmin()) return;
            const val = prompt(`Scor (ex: 2-0):`);
            if(!val) return;
            let [v1, v2] = val.split("-").map(Number);
            let data = {...currentSezonData};
            let meci = data.f1[state.idGrupa].meciuri.find(m => m.id === mId);
            if (titular === p1) { meci[`s1${set}`] = v1; meci[`s2${set}`] = v2; }
            else { meci[`s1${set}`] = v2; meci[`s2${set}`] = v1; }
            meci.gata = true;
            await updateDoc(doc(db, "sezoane", "JOKER_2"), data);
        };

        const calculeazaClasament = (g) => {
            let st = {};
            g.participanti.forEach(p => st[p] = { v: 0, c: 0, p: 0, nume: p });
            g.meciuri.forEach(m => {
                if(!m.gata) return;
                [{s1:m.s1t, s2:m.s2t}, {s1:m.s1r, s2:m.s2r}].forEach(s => {
                    if(s.s1 > s.s2) st[m.p1].v++; else if(s.s2 > s.s1) st[m.p2].v++;
                    st[m.p1].c += s.s1; st[m.p1].p += s.s2;
                    st[m.p2].c += s.s2; st[m.p2].p += s.s1;
                });
            });
            return Object.values(st).sort((a,b) => b.v - a.v || b.c - a.c || a.p - b.p);
        };

        async function render() {
            const root = document.getElementById('app');
            let html = `<div class="max-w-2xl mx-auto p-4 text-white min-h-[85vh]">
                <nav class="flex justify-between items-center mb-8 border-b border-slate-800 pb-4">
                    <h1 onclick="nav('home')" class="text-2xl font-black italic uppercase cursor-pointer">Joker <span class="text-blue-500">#2</span></h1>
                    <div>${userLogat ? `<button onclick="logout()" class="text-[10px] text-red-500 font-bold uppercase">Ie»ôire</button>` : `<button onclick="loginGoogle()" class="text-[10px] text-slate-500 font-bold uppercase">Admin</button>`}</div>
                </nav>`;

            if(state.pagina === "home") {
                html += `<div class="text-center mb-6"><h2 class="text-3xl font-black italic uppercase">Faza Grupelor</h2></div>
                         <div class="mb-6"><input type="text" placeholder="CautƒÉ jucƒÉtor..." value="${state.search}" oninput="handleSearch(this.value)" class="w-full bg-slate-900 border border-slate-800 p-4 rounded-2xl text-sm focus:border-blue-500 outline-none transition-all text-white font-bold"></div>
                         <div onclick="nav('podium')" class="bg-gradient-to-r from-blue-900/40 to-slate-900 border border-blue-500/30 p-6 rounded-3xl mb-10 cursor-pointer hover:scale-[1.02] transition-all group shadow-xl flex justify-between items-center text-xs font-black uppercase tracking-widest text-blue-400">
                            <span>C√¢»ôtigƒÉtor Edi»õia #1</span><span class="group-hover:translate-x-1 transition-transform">üèÜ</span>
                         </div>
                         <div class="grid grid-cols-2 gap-4">`;
                if(currentSezonData) {
                    Object.keys(currentSezonData.f1).sort().forEach(gk => {
                        const participanti = currentSezonData.f1[gk].participanti;
                        if(!state.search || participanti.some(p => p.toLowerCase().includes(state.search))) {
                            html += `<div onclick="nav('grupa', '${gk}')" class="bg-slate-900 p-10 rounded-3xl border border-slate-800 text-center cursor-pointer hover:border-blue-500 transition-all text-4xl font-black italic">${gk}</div>`;
                        }
                    });
                }
                html += `</div>`;
                if(isAdmin()) html += `<button onclick="adminModificaNume()" class="w-full mt-10 bg-slate-800/50 text-slate-500 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest border border-slate-800 italic">EditeazƒÉ Nume JucƒÉtor</button>`;
            } else if(state.pagina === "podium") {
                html += `<button onclick="nav('home')" class="mb-8 text-xs font-bold uppercase text-blue-500 tracking-widest">‚Üê √énapoi</button>
                         <div class="text-center mb-12"><h2 class="text-3xl font-black italic uppercase">Podium Edi»õia #1</h2></div>
                         <div class="space-y-4">

                         <div class="bg-gradient-to-r from-yellow-500/20 to-slate-900 border border-yellow-500/40 p-8 rounded-[2rem] flex justify-between items-center shadow-2xl">
    <div class="flex items-center gap-4">
        <img src="https://scontent.ftsr1-2.fna.fbcdn.net/v/t39.30808-1/617352806_1413674363470096_3505776050909450128_n.jpg?stp=dst-jpg_s200x200_tt6&_nc_cat=110&ccb=1-7&_nc_sid=e99d92&_nc_ohc=qqmckTttG4IQ7kNvwH4r66H&_nc_oc=Adm0wIvLTJczZsxTS2RLzBqQkdWFwsSp0eiw739lEhMcjLdCgfSt68-YWjZQ2nSx-ZXcqg7RTL0DeZmaw4qZkQg-&_nc_zt=24&_nc_ht=scontent.ftsr1-2.fna&_nc_gid=dj-LXBsuVZfMxCvxAhkfGw&oh=00_AfsirvXRtzeVG1g--owSulTkyt6HlrHVeWG-uEkfK8mOsg&oe=698A3615" alt="Ovi MiclƒÉu»ô" class="w-16 h-16 rounded-full border-2 border-yellow-500 object-cover shadow-lg">
        <div>
            <span class="block text-[10px] font-black uppercase text-yellow-500 tracking-tighter">Locul 1 (Trofeu)</span>
            <span class="text-2xl font-black italic uppercase">Ovi MiclƒÉu»ô</span>
        </div>
    </div>
    <div class="text-4xl">üèÜ</div>
</div>
                            <div class="bg-gradient-to-r from-yellow-500/20 to-slate-900 border border-yellow-500/40 p-8 rounded-[2rem] flex justify-between items-center"><div class="text-2xl font-black italic uppercase"><span class="block text-[10px] text-yellow-500">Locul 1</span>Ovi MiclƒÉu»ô</div><div class="text-4xl">üèÜ</div></div>
                            <div class="bg-slate-900 border border-slate-800 p-6 rounded-[2rem] flex justify-between items-center"><div><span class="block text-[10px] text-slate-500 uppercase">Locul 2</span><span class="text-xl font-black italic uppercase text-slate-300">Gerard Miodrag</span></div><div class="text-2xl opacity-50">ü•à</div></div>
                            <div class="bg-slate-900 border border-slate-800 p-6 rounded-[2rem] flex justify-between items-center"><div><span class="block text-[10px] text-slate-500 uppercase">Locul 3</span><span class="text-xl font-black italic uppercase text-slate-400">Dan Marius</span></div><div class="text-2xl opacity-30">ü•â</div></div>
                         </div>`;
            } else if(state.pagina === "grupa") {
                const g = currentSezonData.f1[state.idGrupa], c = calculeazaClasament(g), top2 = c.slice(0, 2).map(x => x.nume);
                html += `<button onclick="nav('home')" class="mb-4 text-xs font-bold uppercase text-blue-500 tracking-widest">‚Üê √énapoi</button>
                         <div class="text-3xl font-black mb-8 uppercase italic text-center text-blue-500">Grupa ${state.idGrupa}</div>
                         <div class="bg-slate-900 p-4 rounded-3xl mb-10 border border-slate-800 shadow-xl">
                            <table class="w-full text-xs font-bold"><tr class="text-slate-500 uppercase text-center"><th class="text-left pb-2">JucƒÉtor</th><th>V</th><th>C</th><th>P</th></tr>
                            ${c.map(x => `<tr class="border-t border-white/5 ${top2.includes(x.nume) ? 'text-green-500' : ''}"><td class="py-3 uppercase italic">${x.nume}</td><td class="text-center font-black">${x.v}</td><td class="text-center">${x.c}</td><td class="text-center ${top2.includes(x.nume) ? 'text-green-900' : 'text-slate-500'}">${x.p}</td></tr>`).join('')}
                            </table></div>`;
                g.participanti.forEach(j => {
                    html += `<div class="mb-8"><h3 class="text-[10px] font-black uppercase text-slate-500 mb-3 ml-1 tracking-widest">${j}</h3>`;
                    g.meciuri.filter(m => m.p1 === j || m.p2 === j).forEach(m => {
                        const adv = m.p1 === j ? m.p2 : m.p1;
                        const sT = m.p1 === j ? `${m.s1t}-${m.s2t}` : `${m.s2t}-${m.s1t}`;
                        const sR = m.p1 === j ? `${m.s1r}-${m.s2r}` : `${m.s2r}-${m.s1r}`;
                        html += `<div class="bg-slate-900/50 p-4 rounded-2xl border border-white/5 flex justify-between items-center mb-2 shadow-sm">
                            <span class="text-[11px] italic uppercase">${adv}</span>
                            <div class="flex gap-2">
                                <button onclick="updateScorMeci('${m.id}','t','${m.p1}','${m.p2}','${j}')" class="bg-black px-3 py-2 rounded-lg border border-slate-800 text-[10px] font-black uppercase">T: ${sT}</button>
                                <button onclick="updateScorMeci('${m.id}','r','${m.p1}','${m.p2}','${j}')" class="bg-black px-3 py-2 rounded-lg border border-slate-800 text-[10px] font-black uppercase">R: ${sR}</button>
                            </div></div>`;
                    });
                    html += `</div>`;
                });
            }
            root.innerHTML = html + `</div><footer class="mt-20 py-10 border-t border-slate-900 text-center"><p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-600">&copy; 2026. Creat de <a href="https://www.facebook.com/isshmenn" target="_blank" class="text-blue-500">Vali Dragomir</a></p></footer>`;
        }

        onAuthStateChanged(auth, u => { userLogat = u; render(); });
        onSnapshot(doc(db, "sezoane", "JOKER_2"), s => { if(s.exists()) { currentSezonData = s.data(); render(); } });
    </script>
</head>
<body class="bg-black font-sans tracking-tight"><div id="app"></div></body>
</html>

