<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turneu Joker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBG5193qgq-dNX41yhCgXrl9WFNLhUiNnU",
            authDomain: "turneu-cruce.firebaseapp.com",
            projectId: "turneu-cruce",
            storageBucket: "turneu-cruce.firebasestorage.app",
            messagingSenderId: "169022341825",
            appId: "1:169022341825:web:53678e9ce275654bfe4a40"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const ADMINS = ["isshmen@gmail.com"];
        let userLogat = null;
        let globalData = { ed_JOKER: 2, inscrisi_JOKER: [] };
        let currentSezonData = null;
        let state = { pagina: "home", idGrupa: null };

        const isAdmin = () => userLogat && ADMINS.includes(userLogat.email);

        window.loginGoogle = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth);
        window.nav = (p, g=null) => { state = { ...state, pagina:p, idGrupa:g }; render(); };

        // BUTONUL CARE STERGE TOT SI REPORNESTE INTERFATA
        window.adminResetTotal = async () => {
            if(!confirm("Ștergi tot sezonul 2 pentru a reface înscrierile?")) return;
            try {
                await deleteDoc(doc(db, "sezoane", "JOKER_2"));
                await setDoc(doc(db, "setari", "turnee"), { ed_JOKER: 2, inscrisi_JOKER: [] }, { merge: true });
                alert("Sistem resetat! Acum poți vedea butoanele de Import.");
            } catch (e) { alert(e.message); }
        };

        window.adminImportJucatori = async () => {
            const lista = ["Jucator 1", "Jucator 2", "Jucator 3", "Jucator 4", "Jucator 5", "Jucator 6", "Jucator 7", "Jucator 8", "Jucator 9", "Jucator 10", "Jucator 11", "Jucator 12", "Jucator 13", "Jucator 14", "Jucator 15", "Jucator 16", "Jucator 17", "Jucator 18", "Jucator 19", "Jucator 20", "Jucator 21", "Jucator 22", "Jucator 23", "Jucator 24", "Jucator 25", "Jucator 26", "Jucator 27", "Jucator 28", "Jucator 29", "Jucator 30", "Jucator 31", "Jucator 32", "Jucator 33", "Jucator 34", "Jucator 35"];
            await updateDoc(doc(db, "setari", "turnee"), { inscrisi_JOKER: lista });
            alert("Jucători importați!");
        };

        window.adminStartSezon = async () => {
            let inscrisi = [...globalData.inscrisi_JOKER];
            let f1 = {};
            const gList = ['A','B','C','D','E','F','G','H'];
            inscrisi.sort(() => Math.random() - 0.5);
            let pointer = 0;
            gList.forEach((gk, idx) => {
                let nr = idx < 3 ? 5 : 4;
                let p = inscrisi.slice(pointer, pointer + nr);
                pointer += nr;
                if(p.length > 0) {
                    f1[gk] = { participanti: p, meciuri: [] };
                    for(let i=0; i<p.length; i++) {
                        for(let j=i+1; j<p.length; j++) {
                            f1[gk].meciuri.push({ id: "M-"+Math.random().toString(36).substr(2,9), p1: p[i], p2: p[j], s1t:0, s2t:0, s1r:0, s2r:0, gata: false });
                        }
                    }
                }
            });
            await setDoc(doc(db, "sezoane", "JOKER_2"), { f1, status: 'activ' });
        };

        async function render() {
            const root = document.getElementById('app');
            const turneuActiv = currentSezonData && currentSezonData.status === 'activ';
            let html = `<div class="max-w-2xl mx-auto p-4 text-white">
                <nav class="flex justify-between items-center mb-8 border-b border-slate-800 pb-4">
                    <h1 onclick="nav('home')" class="text-2xl font-black italic uppercase cursor-pointer">Joker <span class="text-blue-500">#2</span></h1>
                    <div>${userLogat ? `<button onclick="logout()" class="text-[10px] text-red-500 font-bold uppercase">Ieșire</button>` : ''}</div>
                </nav>`;

            if(!userLogat) {
                html += `<button onclick="loginGoogle()" class="w-full bg-white text-black py-4 rounded-xl font-bold uppercase">Login Admin</button>`;
            } else if(state.pagina === "home") {
                if(!turneuActiv) {
                    const inscrisi = globalData.inscrisi_JOKER || [];
                    html += `<div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                        <h2 class="mb-4 font-bold uppercase text-slate-400">Înscrieri (${inscrisi.length})</h2>
                        <div class="flex flex-wrap gap-2 mb-6">${inscrisi.map(n => `<span class="bg-black px-3 py-1 rounded-lg text-xs border border-white/10">${n}</span>`).join('')}</div>
                        ${isAdmin() ? `<button onclick="adminImportJucatori()" class="w-full bg-slate-800 py-3 rounded-xl mb-2 text-xs font-bold uppercase">1. Importă Jucători</button>
                                       <button onclick="adminStartSezon()" class="w-full bg-blue-600 py-3 rounded-xl text-xs font-bold uppercase">2. Start Sezon 1vs1</button>` : ''}
                    </div>`;
                } else {
                    html += `<div class="grid grid-cols-2 gap-4">`;
                    Object.keys(currentSezonData.f1).sort().forEach(gk => {
                        html += `<div onclick="nav('grupa', '${gk}')" class="bg-slate-900 p-10 rounded-3xl border border-slate-800 text-center cursor-pointer hover:border-blue-500 transition-all text-4xl font-black italic">${gk}</div>`;
                    });
                    html += `</div>`;
                    if(isAdmin()) html += `<button onclick="adminResetTotal()" class="w-full mt-10 text-[10px] text-slate-600 uppercase font-bold">Reset Total Sezon (Admin)</button>`;
                }
            } else if(state.pagina === "grupa") {
                html += `<button onclick="nav('home')" class="mb-4 text-xs font-bold uppercase text-blue-500">← Înapoi</button>
                         <div class="text-3xl font-black mb-6 uppercase italic text-center">Grupa ${state.idGrupa}</div>`;
                // ... (restul logicii de afisare meciuri rămâne la fel)
            }
            root.innerHTML = html + `</div>`;
        }

        onAuthStateChanged(auth, u => { 
            userLogat = u; 
            onSnapshot(doc(db, "setari", "turnee"), s => { if(s.exists()) globalData = s.data(); render(); }); 
            onSnapshot(doc(db, "sezoane", "JOKER_2"), s => { currentSezonData = s.exists() ? s.data() : null; render(); }); 
        });
    </script>
</head>
<body class="bg-black font-sans tracking-tight"><div id="app"></div></body>
</html>
